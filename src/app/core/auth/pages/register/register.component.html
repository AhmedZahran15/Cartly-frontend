<section
  class="flex flex-col items-center justify-center min-h-screen bg-primary-50 p-4"
>
  <div class="w-full max-w-md">
    <div class="bg-white rounded-xl shadow-lg p-8">
      <div class="text-center mb-6">
        <h1 class="text-3xl font-bold text-primary-700 mb-1">Create Account</h1>
        <p class="text-gray-600">Join Cartly today</p>
      </div>

      <form
        [formGroup]="registerForm"
        (ngSubmit)="onSubmit()"
        class="space-y-4"
      >
        <div class="grid grid-cols-2 gap-4">
          <div class="field">
            <label
              for="firstName"
              class="block text-sm font-medium text-gray-700 mb-1"
              >First Name</label
            >
            <div class="relative">
              <i
                class="pi pi-user absolute left-3 top-1/2 transform -translate-y-1/2 z-10"
                [ngClass]="{
                  'text-gray-500': !(
                    registerForm.get('firstName')?.invalid &&
                    (registerForm.get('firstName')?.dirty ||
                      registerForm.get('firstName')?.touched)
                  ),
                  'text-red-500':
                    registerForm.get('firstName')?.invalid &&
                    (registerForm.get('firstName')?.dirty ||
                      registerForm.get('firstName')?.touched)
                }"
              ></i>
              <input
                id="firstName"
                type="text"
                pInputText
                formControlName="firstName"
                class="w-full pl-10"
                placeholder="First Name"
                [ngClass]="{
                  'ng-invalid ng-dirty':
                    registerForm.get('firstName')?.invalid &&
                    (registerForm.get('firstName')?.dirty ||
                      registerForm.get('firstName')?.touched)
                }"
              />
            </div>
            @if (registerForm.get('firstName')?.errors?.['required'] &&
            (registerForm.get('firstName')?.dirty ||
            registerForm.get('firstName')?.touched)) {
            <p-message
              severity="error"
              variant="simple"
              size="small"
              text="First name is required"
            >
            </p-message>
            } @if (getServerError('firstName')) {
            <p-message
              severity="error"
              variant="simple"
              size="small"
              [text]="getServerError('firstName')!"
            >
            </p-message>
            }
          </div>

          <div class="field">
            <label
              for="lastName"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Last Name</label
            >
            <div class="relative">
              <i
                class="pi pi-user absolute left-3 top-1/2 transform -translate-y-1/2 z-10"
                [ngClass]="{
                  'text-gray-500': !(
                    registerForm.get('lastName')?.invalid &&
                    (registerForm.get('lastName')?.dirty ||
                      registerForm.get('lastName')?.touched)
                  ),
                  'text-red-500':
                    registerForm.get('lastName')?.invalid &&
                    (registerForm.get('lastName')?.dirty ||
                      registerForm.get('lastName')?.touched)
                }"
              ></i>
              <input
                id="lastName"
                type="text"
                pInputText
                formControlName="lastName"
                class="w-full pl-10"
                placeholder="Last Name"
                [ngClass]="{
                  'ng-invalid ng-dirty':
                    registerForm.get('lastName')?.invalid &&
                    (registerForm.get('lastName')?.dirty ||
                      registerForm.get('lastName')?.touched)
                }"
              />
            </div>
            @if (registerForm.get('lastName')?.errors?.['required'] &&
            (registerForm.get('lastName')?.dirty ||
            registerForm.get('lastName')?.touched)) {
            <p-message
              severity="error"
              variant="simple"
              size="small"
              text="Last name is required"
            >
            </p-message>
            } @if (getServerError('lastName')) {
            <p-message
              severity="error"
              variant="simple"
              size="small"
              [text]="getServerError('lastName')!"
            >
            </p-message>
            }
          </div>
        </div>

        <div class="field">
          <label
            for="dateOfBirth"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Birth Date</label
          >
          <div class="relative">
            <i
              class="pi pi-calendar absolute left-3 top-1/2 transform -translate-y-1/2 z-10"
              [ngClass]="{
                'text-gray-500': !(
                  registerForm.get('dateOfBirth')?.invalid &&
                  (registerForm.get('dateOfBirth')?.dirty ||
                    registerForm.get('dateOfBirth')?.touched)
                ),
                'text-red-500':
                  registerForm.get('dateOfBirth')?.invalid &&
                  (registerForm.get('dateOfBirth')?.dirty ||
                    registerForm.get('dateOfBirth')?.touched)
              }"
            ></i>
            <p-datePicker
              id="dateOfBirth"
              formControlName="dateOfBirth"
              [showIcon]="false"
              [maxDate]="maxDate"
              styleClass="w-full"
              inputStyleClass="w-full pl-10"
              placeholder="Select your birth date"
              dateFormat="dd/mm/yy"
              [ngClass]="{
                'ng-invalid ng-dirty':
                  registerForm.get('dateOfBirth')?.invalid &&
                  (registerForm.get('dateOfBirth')?.dirty ||
                    registerForm.get('dateOfBirth')?.touched)
              }"
            ></p-datePicker>
          </div>
          @if (registerForm.get('dateOfBirth')?.errors?.['required'] &&
          (registerForm.get('dateOfBirth')?.dirty ||
          registerForm.get('dateOfBirth')?.touched)) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            text="Birth date is required"
          >
          </p-message>
          } @if (getServerError('dateOfBirth')) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            [text]="getServerError('dateOfBirth')!"
          >
          </p-message>
          }
        </div>

        <div class="field">
          <label
            for="gender"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Gender</label
          >
          <div class="relative">
            <i
              class="pi pi-mars absolute left-3 top-1/2 transform -translate-y-1/2 z-10"
              [ngClass]="{
                'text-gray-500': !(
                  registerForm.get('gender')?.invalid &&
                  (registerForm.get('gender')?.dirty ||
                    registerForm.get('gender')?.touched)
                ),
                'text-red-500':
                  registerForm.get('gender')?.invalid &&
                  (registerForm.get('gender')?.dirty ||
                    registerForm.get('gender')?.touched)
              }"
            ></i>
            <i
              class="pi pi-venus absolute right-3 top-1/2 transform -translate-y-1/2 z-10"
              [ngClass]="{
                'text-gray-500': !(
                  registerForm.get('gender')?.invalid &&
                  (registerForm.get('gender')?.dirty ||
                    registerForm.get('gender')?.touched)
                ),
                'text-red-500':
                  registerForm.get('gender')?.invalid &&
                  (registerForm.get('gender')?.dirty ||
                    registerForm.get('gender')?.touched)
              }"
            ></i>
            <p-selectButton
              id="gender"
              formControlName="gender"
              [options]="genderOptions"
              styleClass="w-full flex"
              [ngClass]="{
                'ng-invalid ng-dirty':
                  registerForm.get('gender')?.invalid &&
                  (registerForm.get('gender')?.dirty ||
                    registerForm.get('gender')?.touched)
              }"
            ></p-selectButton>
          </div>
          @if (registerForm.get('gender')?.errors?.['required'] &&
          (registerForm.get('gender')?.dirty ||
          registerForm.get('gender')?.touched)) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            text="Gender is required"
          >
          </p-message>
          } @if (getServerError('gender')) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            [text]="getServerError('gender')!"
          >
          </p-message>
          }
        </div>

        <div class="field">
          <label
            for="email"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Email</label
          >
          <div class="relative">
            <i
              class="pi pi-envelope absolute left-3 top-1/2 transform -translate-y-1/2 z-10"
              [ngClass]="{
                'text-gray-500': !(
                  registerForm.get('email')?.invalid &&
                  (registerForm.get('email')?.dirty ||
                    registerForm.get('email')?.touched)
                ),
                'text-red-500':
                  registerForm.get('email')?.invalid &&
                  (registerForm.get('email')?.dirty ||
                    registerForm.get('email')?.touched)
              }"
            ></i>
            <input
              id="email"
              type="email"
              pInputText
              formControlName="email"
              class="w-full pl-10"
              placeholder="Email address"
              [ngClass]="{
                'ng-invalid ng-dirty':
                  registerForm.get('email')?.invalid &&
                  (registerForm.get('email')?.dirty ||
                    registerForm.get('email')?.touched)
              }"
            />
          </div>
          @if (registerForm.get('email')?.errors?.['required'] &&
          (registerForm.get('email')?.dirty ||
          registerForm.get('email')?.touched)) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            text="Email is required"
          >
          </p-message>
          } @if (registerForm.get('email')?.errors?.['email'] &&
          (registerForm.get('email')?.dirty ||
          registerForm.get('email')?.touched)) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            text="Please enter a valid email address"
          >
          </p-message>
          } @if (getServerError('email')) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            [text]="getServerError('email')!"
          >
          </p-message>
          }
        </div>

        <div class="field">
          <label
            for="phone"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Phone</label
          >
          <div class="relative">
            <i
              class="pi pi-phone absolute left-3 top-1/2 transform -translate-y-1/2 z-10"
              [ngClass]="{
                'text-gray-500': !(
                  registerForm.get('phone')?.invalid &&
                  (registerForm.get('phone')?.dirty ||
                    registerForm.get('phone')?.touched)
                ),
                'text-red-500':
                  registerForm.get('phone')?.invalid &&
                  (registerForm.get('phone')?.dirty ||
                    registerForm.get('phone')?.touched)
              }"
            ></i>
            <input
              id="phone"
              type="tel"
              pInputText
              formControlName="phone"
              class="w-full pl-10"
              placeholder="Phone number"
              [ngClass]="{
                'ng-invalid ng-dirty':
                  registerForm.get('phone')?.invalid &&
                  (registerForm.get('phone')?.dirty ||
                    registerForm.get('phone')?.touched)
              }"
            />
          </div>
          @if (registerForm.get('phone')?.errors?.['required'] &&
          (registerForm.get('phone')?.dirty ||
          registerForm.get('phone')?.touched)) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            text="Phone number is required"
          >
          </p-message>
          } @if (registerForm.get('phone')?.errors?.['pattern'] &&
          (registerForm.get('phone')?.dirty ||
          registerForm.get('phone')?.touched)) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            text="Please enter a valid phone number"
          >
          </p-message>
          } @if (getServerError('phone')) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            [text]="getServerError('phone')!"
          >
          </p-message>
          }
        </div>

        <div class="field">
          <label
            for="password"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Password</label
          >
          <div class="relative">
            <div
              class="absolute left-3 top-1/2 transform -translate-y-1/2 z-10 pointer-events-none"
            >
              <i
                class="pi pi-lock"
                [ngClass]="{
                  'text-gray-500': !(
                    registerForm.get('password')?.invalid &&
                    (registerForm.get('password')?.dirty ||
                      registerForm.get('password')?.touched)
                  ),
                  'text-red-500':
                    registerForm.get('password')?.invalid &&
                    (registerForm.get('password')?.dirty ||
                      registerForm.get('password')?.touched)
                }"
              ></i>
            </div>
            <p-password
              id="password"
              formControlName="password"
              [toggleMask]="true"
              styleClass="w-full"
              inputStyleClass="w-full pl-10"
              [feedback]="true"
              placeholder="Create password"
              [ngClass]="{
                'ng-invalid ng-dirty':
                  registerForm.get('password')?.invalid &&
                  (registerForm.get('password')?.dirty ||
                    registerForm.get('password')?.touched)
              }"
            ></p-password>
          </div>
          @if (registerForm.get('password')?.errors?.['required'] &&
          (registerForm.get('password')?.dirty ||
          registerForm.get('password')?.touched)) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            text="Password is required"
          >
          </p-message>
          } @if (registerForm.get('password')?.errors?.['pattern'] &&
          (registerForm.get('password')?.dirty ||
          registerForm.get('password')?.touched)) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            text="Password must include at least one uppercase letter, one lowercase letter, one number, and one special character"
          >
          </p-message>
          } @if (getServerError('password')) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            [text]="getServerError('password')!"
          >
          </p-message>
          }
        </div>

        <div class="field">
          <label
            for="confirmPassword"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Confirm Password</label
          >
          <div class="relative">
            <div
              class="absolute left-3 top-1/2 transform -translate-y-1/2 z-10 pointer-events-none"
            >
              <i
                class="pi pi-lock"
                [ngClass]="{
                  'text-gray-500': !(
                    registerForm.get('confirmPassword')?.invalid &&
                    (registerForm.get('confirmPassword')?.dirty ||
                      registerForm.get('confirmPassword')?.touched)
                  ),
                  'text-red-500':
                    registerForm.get('confirmPassword')?.invalid &&
                    (registerForm.get('confirmPassword')?.dirty ||
                      registerForm.get('confirmPassword')?.touched)
                }"
              ></i>
            </div>
            <p-password
              id="confirmPassword"
              formControlName="confirmPassword"
              [toggleMask]="true"
              [feedback]="false"
              styleClass="w-full"
              inputStyleClass="w-full pl-10"
              placeholder="Confirm password"
              [ngClass]="{
                'ng-invalid ng-dirty':
                  registerForm.get('confirmPassword')?.invalid &&
                  (registerForm.get('confirmPassword')?.dirty ||
                    registerForm.get('confirmPassword')?.touched)
              }"
            ></p-password>
          </div>
          @if (registerForm.get('confirmPassword')?.errors?.['required'] &&
          (registerForm.get('confirmPassword')?.dirty ||
          registerForm.get('confirmPassword')?.touched)) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            text="Please confirm your password"
          >
          </p-message>
          } @if (registerForm.errors?.['passwordMismatch'] &&
          registerForm.get('confirmPassword')?.dirty) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            text="Passwords do not match"
          >
          </p-message>
          } @if (getServerError('confirmPassword')) {
          <p-message
            severity="error"
            variant="simple"
            size="small"
            [text]="getServerError('confirmPassword')!"
          >
          </p-message>
          }
        </div>

        <button
          type="submit"
          pButton
          [loading]="loading"
          [disabled]="registerForm.invalid || loading"
          label="Create Account"
          class="p-button-primary w-full"
        ></button>
      </form>

      <p-divider align="center">
        <span class="text-gray-500 px-3">OR</span>
      </p-divider>

      <div class="text-center mt-4">
        <p class="text-gray-600 text-sm">
          Already have an account?
          <a routerLink="/auth/login" class="text-primary-600 hover:underline">
            Sign in
          </a>
        </p>
      </div>
    </div>
  </div>

  <p-toast></p-toast>
</section>
